(function($){$.fn.gMap=function(options){if(typeof (google.maps)!=="object"){return false}var args=Array.prototype.slice.call(arguments,1);var res=this;this.each(function(i,_element){var element=$(_element);var map=element.data("gMap");var result;if(typeof (options)==="string"){console.log("METHOD");if(map&&$.isFunction(map[options])){console.log(options);result=map[options].apply(map,args);if(!i){res=result}if(options==="destroy"){console.log("DESTROY");element.removeData("gMap");element.innerHTML=""}}}else{if(!map){map=new gMap(element,options,_element);element.data("gMap",map);map.show.apply(map,args)}}});return res};function isForcedAtomicOption(name){return/(Time|Duration)$/.test(name)}function mergeOptions(target){function mergeIntoTarget(name,value){if($.isPlainObject(value)&&$.isPlainObject(target[name])&&!isForcedAtomicOption(name)){target[name]=mergeOptions({},target[name],value)}else{if(value!==undefined){target[name]=value}}}for(var i=1;i<arguments.length;i++){$.each(arguments[i],mergeIntoTarget)}return target}var defaultOptions={zoom:7,center:new google.maps.LatLng(45.899912,24.797944),backgroundColor:"#ffffff",mapTypeId:google.maps.MapTypeId.ROADMAP,centerOnWindowResize:true,markers:[]};function gMap(element,iOptions,_element){var t=this;t.map=null;t._element=_element;t.options=mergeOptions(defaultOptions,(iOptions||{}));t.markers=t.options.markers;t.options.markers=null;t.getLatLng=function(lat,lng){if(is_numeric(lat)&&is_numeric(lng)){return new google.maps.LatLng(lat,lng)}return null};t.getLatLngFromAdderss=function(address){if(address&&address.length){var geocoder=new google.maps.Geocoder();geocoder.geocode({address:address},function(results,status){if(status==google.maps.GeocoderStatus.OK){return results[0].geometry.location}else{return null}})}return null};t.addMarker=function(marker){var newMarker=prepareMarker(marker);if(typeof (newMarker)!="object"){return false}var gMarker=new google.maps.Marker({position:newMarker.position,title:newMarker.infoTitle,icon:newMarker.icon,map:t.map});if(newMarker.infoTitle||newMarker.infoContent){var infoString=(newMarker.infoTitle?'<h5 class="small">'+newMarker.infoTitle+"</h5>":"")+(newMarker.infoContent?'<p class="remove-bottom">'+newMarker.infoContent+"</p>":"");var infowindow=new google.maps.InfoWindow({content:infoString,maxWidth:newMarker.infoMaxWidth});google.maps.event.addListener(gMarker,"click",function(){infowindow.open(t.map,gMarker)})}};t.show=function(zoom,marker){if(is_numeric(zoom)){t.options.zoom=zoom}if(typeof (marker)=="object"){t.markers[t.markers.length]=marker;if(is_numeric(marker.lat)&&is_numeric(marker.lng)){t.options.center=t.getLatLng(marker.lat,marker.lng)}}else{if(typeof (t.markers)=="object"&&t.markers.length>0){t.options.center=getCenter(t.markers)}}google.maps.event.addDomListener(window,"load",initialize);if(t.options.centerOnWindowResize&&typeof (t.options.center)=="object"){$(window).on("resize",function(){var timer=window.setTimeout(function(){window.clearTimeout(timer);gMap.map.panTo(t.options.center)},30)})}};t.claerMarkers=function(){t.markers={}};t.mapOptions=function(){return getMapOptions(t.options)};function getMapOptions(options){if(typeof (options)!="object"){return null}return{zoom:options.zoom,center:options.center,backgroundColor:options.backgroundColor,mapTypeId:options.mapTypeId}}function prepareMarker(marker){if(typeof (marker)!="object"){return false}if(marker.byAddress===true||marker.byAddress===1){var position=t.getLatLngFromAdderss(marker.address)}else{var position=t.getLatLng(marker.lat,marker.lng)}if(typeof (position)!="object"){return false}var infoTitle=(marker.title&&marker.title.length)?marker.title:null;var infoContent=(marker.desc&&marker.desc.length)?marker.desc:null;var pMarket={position:position,icon:marker.icon,infoTitle:infoTitle,infoContent:infoContent,infoMaxWidth:300};return pMarket}function getCenter(markers){if((typeof (markers)!="array"&&typeof (markers)!="object")||markers.length<=0){return null}var minLat=0,maxLat=0,minLng=0,maxLng=0,cLat=0,cLng=0;for(var i=0;i<markers.length;i++){var pMarker=prepareMarker(markers[i]);if(typeof (pMarker)!="object"||pMarker.length<=0){continue}if(i==0){minLat=pMarker.position.lat();maxLat=pMarker.position.lat();minLng=pMarker.position.lng();maxLng=pMarker.position.lng()}else{minLat=Math.min(minLat,pMarker.position.lat());maxLat=Math.max(maxLat,pMarker.position.lat());minLng=Math.min(minLng,pMarker.position.lng());maxLng=Math.max(maxLng,pMarker.position.lng())}}cLat=(minLat+maxLat)/2;cLng=(minLng+maxLng)/2;if(cLat>0&&cLng>0){return t.getLatLng(cLat,cLng)}return null}function initialize(){t.map=new google.maps.Map(t._element,t.mapOptions());if((typeof (t.markers)=="array"||typeof (t.markers)=="object")&&t.markers.length>0){for(var i=0;i<t.markers.length;i++){t.addMarker(t.markers[i])}}}}})(jQuery);